<!DOCTYPE html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css">
    <link rel="stylesheet" href="/static/zenburn.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
    <script src="/dist/index.js"></script>
    <link rel="stylesheet" href="/css/global.css">
</head>
<body>
<div class="container">
    <h1>tply demo</h1>

    <div class="examples">
        <div class="example-container">
            <div class="example">
                <div class="tply-template">
                    <type>this is an example</type>
                    <wait>500ms</wait>
                </div>
            </div>
        </div>
        <div class="example-container">
            <div class="example">
                <div class="tply-template">
                    <type>this is an example</type>
                    <wait>500ms</wait>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            "use strict";

            let unindentCode = function (text) {
                let nonWhitespaceFound = false;
                let skippingWhitespace = false;
                let skipCount = 0;
                let whitespaceCount = 0;
                let result = "";
                let lastReturn = text.lastIndexOf("\n");

                for (let i = 0; i < text.length; i++) {
                    if (!nonWhitespaceFound) {
                        if (text[i] == " ") {
                            whitespaceCount++;
                        } else if (text[i] != "\n") {
                            result += text[i];
                            nonWhitespaceFound = true;
                        }
                    } else {
                        if (skippingWhitespace) {
                            if (++skipCount >= whitespaceCount) {
                                skippingWhitespace = false;
                            }
                        } else {
                            if (text[i] == "\n") {
                                if (i == lastReturn) {
                                    break;
                                }
                                
                                skippingWhitespace = true;
                                result += text[i];
                            } else {
                                result += text[i];
                            }
                        }
                    }
                }

                return result;
            };

            let examples = document.querySelectorAll(".examples .example-container");

            for (let i = 0; i < examples.length; i++) {
                let exampleContainer = examples[i];

                let template = exampleContainer.querySelector(".tply-template");
                let destination = document.createElement("div");
                destination.classList.add(".tply-destination");
                template.parentNode.appendChild(destination);

                let code = document.createElement("code");
                let pre = document.createElement("pre");

                pre.innerText = unindentCode(template.innerHTML);

                code.appendChild(pre);
                exampleContainer.appendChild(code);

                hljs.highlightBlock(code);

                tply.animate(template, destination);
            }
        })();
    </script>
</div>
</body>
</html>